<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><title>Understanding the Roles of Zookeeper and Bookkeeper in Pulsar - Pulsar Neighborhood</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Although they have some similarities, ZooKeeper and BookKeeper provide different administrative services in Pulsar. This article will help you to understand how ZooKeeper and BookKeeper work."><meta property="og:title" content="Understanding the Roles of Zookeeper and Bookkeeper in Pulsar - Pulsar Neighborhood"><meta property="og:type" content="article"><meta property="og:url" content="https://www.pulsar-neighborhood.io/articles/understanding-the-roles-of-zookeeper-and-bookkeeper-in-pulsar/"><meta property="og:image" content="https://www.pulsar-neighborhood.io/png/blue-logotype.png"><meta name=description content="Although they have some similarities, ZooKeeper and BookKeeper provide different administrative services in Pulsar. This article will help you to understand how ZooKeeper and BookKeeper work."><meta name=twitter:site content="@pulsar_neighbor"><meta name=twitter:creator content="@pulsar_neighbor"><link rel=alternate type=application/rss+xml href=/index.xml title="Site Title"><meta name=google-site-verification content="m-1Z-0k0EvG9PD7R24pKuETSaBpEvqoXgOYT-0MtuPU"><link rel=icon href=https://www.pulsar-neighborhood.io/favicon.png><link rel=canonical href=https://www.pulsar-neighborhood.io/articles/understanding-the-roles-of-zookeeper-and-bookkeeper-in-pulsar/><link rel=stylesheet href=/css/style.32ad96ee983b063b549f59db931afb8f0db25424bf2d687e1122748a7d183f73.css><style>.ctct-form-defaults{padding:15px!important}</style><script type=application/ld+json>[{"@context":"http://schema.org","@type":"WebPage","name":"Pulsar Neighborhood - Understanding the Roles of Zookeeper and Bookkeeper in Pulsar","description":"Although they have some similarities, ZooKeeper and BookKeeper provide different administrative services in Pulsar. This article will help you to understand how ZooKeeper and BookKeeper work.","publisher":{"@type":"Organization","name":"Pulsar Neighborhood"},"keywords":["bookkeeper, zookeeper, apache pulsar"]},{"@context":"http://schema.org","@type":"BlogPosting","image":"https://www.pulsar-neighborhood.io/images/blue-logotype.png","url":"https:\/\/www.pulsar-neighborhood.io\/articles\/understanding-the-roles-of-zookeeper-and-bookkeeper-in-pulsar\/","publisher":"Pulsar Neighborhood","headline":"Understanding the Roles of Zookeeper and Bookkeeper in Pulsar","dateCreated":"2022-08-23 13:41:03 -0400 -0400","datePublished":"2022-08-23 13:41:03 -0400 -0400","dateModified":"2022-08-23 13:41:03 -0400 -0400","inLanguage":"en-US","isFamilyFriendly":"true","copyrightYear":"2022","copyrightHolder":"","author":{"@type":"Person","name":"Pulsar Neighborhood","url":"https://www.pulsar-neighborhood.io"},"mainEntityOfPage":"True","articleSection":["pulsar-architecture, pulsar-components"],"keywords":["bookkeeper, zookeeper, apache pulsar"],"articleBody":"\u003cp\u003eApache Pulsar is a well-known open-source platform for handling distributed event streams to serve real-time use cases. To carry out its operations, perform administrative tasks, and manage storage, Pulsar uses external components. Two of these components are \u003ca href=\u0022https:\/\/pulsar.apache.org\/docs\/administration-zk-bk\/\u0022 target=\u0022_blank\u0022\u003eZooKeeper and BookKeeper\u003c\/a\u003e.\u003c\/p\u003e\n\u003cp\u003eZooKeeper and BookKeeper are both open-source Apache products. Yahoo developed these libraries and then released them as open source to the Apache Software Foundation. In Pulsar, ZooKeeper handles configuration and coordination-related tasks, while BookKeeper is responsible for the persistent storage of message data.\u003c\/p\u003e\n\u003cp\u003eAlthough they have some similarities, ZooKeeper and BookKeeper provide different administrative services in Pulsar. This article will help you to understand how ZooKeeper and BookKeeper work, the roles these components play in Pulsar, and the differences between ZooKeeper and BookKeeper, highlighting use cases where each component is particularly useful.\u003c\/p\u003e\n\u003ch2 id=\u0022overview-zookeeper-and-bookkeeper\u0022\u003eOverview: ZooKeeper and BookKeeper\u003c\/h2\u003e\n\u003cp\u003eBefore turning to the roles that ZooKeeper and BookKeeper play in Pulsar, let’s take a closer look at what each of these components are.\u003c\/p\u003e\n\u003ch3 id=\u0022zookeeper\u0022\u003eZooKeeper\u003c\/h3\u003e\n\u003cp\u003eApache ZooKeeper is a battle-tested service developed to serve some of the key requirements of distributed applications. These include:\u003c\/p\u003e\n\u003cul\u003e\n\u003cli\u003eConfiguration management\u003c\/li\u003e\n\u003cli\u003eNaming service\u003c\/li\u003e\n\u003cli\u003eLeader election process\u003c\/li\u003e\n\u003cli\u003eDistributed synchronization service\u003c\/li\u003e\n\u003c\/ul\u003e\n\u003cp\u003eThe above features are essential for a distributed application. Zookeeper has these features out of the box, making task coordination in a distributed application much simpler.\u003c\/p\u003e\n\u003cp\u003eAlthough ZooKeeper serves several distributed application needs, it’s the application’s responsibility to know which ZooKeeper features are required that the integrated application requires. For example, a distributed application that integrates with ZooKeeper can use its configuration management to store certain metadata specific to the application, which might differ from the metadata or configuration data stored by another distributed application.\u003c\/p\u003e\n\u003cp\u003eZooKeeper has a filesystem-like directory structure, called znodes, to manage configuration data. Each znode can store data of a maximum size of 1 MB and can have another child node. The entire hierarchical structure of znodes is available for access in the ZooKeeper cluster nodes’ memory. This way, a swift and scalable response can be achieved when a configuration read request comes from a client.\u003c\/p\u003e\n\u003ch3 id=\u0022bookkeeper\u0022\u003eBookKeeper\u003c\/h3\u003e\n\u003cp\u003eApache BookKeeper was originally a sub-project developed under ZooKeeper. Later, it emerged as a top-level project. BookKeeper is a highly scalable, reliable, and performant storage solution optimized to serve real-time workloads. Following are some of the BookKeeper’s capabilities:\u003c\/p\u003e\n\u003cul\u003e\n\u003cli\u003eHigh-performance distributed storage solution\u003c\/li\u003e\n\u003cli\u003eHighly scalable\u003c\/li\u003e\n\u003cli\u003eProvides IO isolation\u003c\/li\u003e\n\u003cli\u003eData replication\u003c\/li\u003e\n\u003cli\u003eTargeted message placement\u003c\/li\u003e\n\u003c\/ul\u003e\n\u003ch2 id=\u0022zookeeper-and-bookkeeper-whats-the-difference\u0022\u003eZooKeeper and BookKeeper: What’s the Difference?\u003c\/h2\u003e\n\u003cp\u003eNow that you have understood the high-level overview of ZooKeeper and BookKeeper, the following section will provide you with the details:\u003c\/p\u003e\n\u003cul\u003e\n\u003cli\u003eWhat’s the difference between these components?\u003c\/li\u003e\n\u003cli\u003eWhich role do these components play in Pulsar?\u003c\/li\u003e\n\u003cli\u003eHow does Pulsar use these components for various use cases to meet its goals?\u003c\/li\u003e\n\u003c\/ul\u003e\n\u003ch3 id=\u0022the-role-of-zookeeper-in-pulsar\u0022\u003eThe Role of ZooKeeper in Pulsar\u003c\/h3\u003e\n\u003cp\u003ePulsar architecture supports multi-cluster deployment models distributed across multiple geographical regions. This is configurable per the customer’s need and policy on high availability and disaster recovery plans. Regardless of whether it’s a Pulsar instance with a single cluster or multiple clusters, the role of ZooKeeper is to handle configuration, the leader-election process, and coordination tasks for a Pulsar instance.\u003c\/p\u003e\n\u003cp\u003eFrom an administrative perspective, note that two separate ZooKeeper quorums are involved in the Pulsar instance. A quorum in ZooKeeper is the minimum number of ZooKeeper nodes in a cluster that should be available to serve the client requests.\u003c\/p\u003e\n\u003cp\u003eOne quorum serves individual cluster-level configuration management and coordination of tasks within the cluster. The other quorum is for global configuration management and task coordination of an entire Pulsar instance with multiple clusters.\u003c\/p\u003e\n\u003cp\u003eIn the case of a Pulsar instance with a single cluster, you can use the same cluster of ZooKeeper nodes both for local cluster needs and global instance needs. This is usually done to save resource costs and minimize the effort involved with server administration tasks.\u003c\/p\u003e\n\u003cp\u003eHowever, in the case of a Pulsar instance with a multi-cluster deployment mode distributed across various geographical regions, ensure a separate global configuration store configured to include ZooKeeper clusters from multiple regions. This setup enables high availability in the event of failures and facilitates topic partitions spanning different regions. To understand more on this, refer to \u003ca href=\u0022https:\/\/pulsar.apache.org\/docs\/administration-zk-bk\/#deploy-configuration-store\u0022 target=\u0022_blank\u0022\u003ePulsar documentation\u003c\/a\u003e.\u003c\/p\u003e\n\u003ch3 id=\u0022use-cases-of-zookeeper-in-pulsar\u0022\u003eUse Cases of ZooKeeper in Pulsar\u003c\/h3\u003e\n\u003cp\u003ePulsar uses Apache ZooKeeper for use cases that include those outlined below.\u003c\/p\u003e\n\u003ch4 id=\u0022leader-election-process\u0022\u003eLeader Election Process\u003c\/h4\u003e\n\u003cp\u003eA leader node is the one that is responsible for writes, and the other nodes, the followers, receive the updates made by the leader node. In this way, all cluster nodes eventually become consistent with the data. In the case of read requests, any node in the cluster can serve the request.\u003c\/p\u003e\n\u003cp\u003eFor example, assume there are three nodes in a ZooKeeper cluster, with node 1 elected as a leader node, and nodes 2 and 3 marked as followers. Any write or update requests will be forwarded to node 1 to handle the request, and the other nodes will eventually become synchronized with the updated data. When a client application sends a read request to any of the ZooKeeper follower nodes, the data is served locally from that follower node.\u003c\/p\u003e\n\u003cp\u003eThis is possible because, in ZooKeeper, all the nodes have the data to serve the read request. When a leader node goes down in a cluster, a quorum is established, and a new leader is elected from the followers. This process happens automatically and should occur as efficiently as possible.\u003c\/p\u003e\n\u003ch4 id=\u0022metadata-and-configuration-management\u0022\u003eMetadata and Configuration Management\u003c\/h4\u003e\n\u003cp\u003ePulsar instance configuration, such as cluster configuration data, tenants and namespace metadata information, and topic metadata, are stored in ZooKeeper. The broker in Pulsar ought to know the ledgers that correspond to a topic. Such metadata information is also stored in ZooKeeper. Whenever a client requests any configuration\/metadata information stored in the ZooKeeper, it gets served.\u003c\/p\u003e\n\u003ch4 id=\u0022monitoring-the-health-status-of-nodes\u0022\u003eMonitoring the Health Status of Nodes\u003c\/h4\u003e\n\u003cp\u003eZooKeeper stores the health information of each broker in the Pulsar cluster through its ephemeral znodes. Ephemeral znodes are a kind of znode that exist as long as the corresponding client session is active. It means there is an internal mapping and metadata information in ZooKeeper to understand which znodes are for which broker session.\u003c\/p\u003e\n\u003cp\u003eOnce the client session is closed\/unavailable, the corresponding znode will be removed from ZooKeeper. This way, the availability of information on which brokers are active to serve topics and which brokers are dying or dead already are maintained in ZooKeeper. The znode removal action\/information of dead brokers is used during task coordination to decide\/choose a suitable active broker to serve a client’s request (producer\/consumer client) for acting on a message\/event.\u003c\/p\u003e\n\u003ch3 id=\u0022the-role-of-bookkeeper-in-pulsar\u0022\u003eThe Role of BookKeeper in Pulsar\u003c\/h3\u003e\n\u003cp\u003eThe role of BookKeeper in Pulsar is to handle message\/event storage needs for a Pulsar instance. Where do the incoming messages to a Pulsar topic get stored? The answer is in BookKeeper nodes\/Bookies.\u003c\/p\u003e\n\u003cp\u003eA producer client generates messages\/events and reaches the broker node. Broker being a stateless component in Pulsar, forwards the messages to Bookies for persistence. Bookies are based on a distributed Write-Ahead Log system that utilizes the ledger mechanism to store received messages.\u003c\/p\u003e\n\u003cp\u003eA ledger is an important concept in the BookKeeper. It’s like a file that’s opened only once to write and append the data only to the end. However, data read from the ledger at a random position, such as from the middle, is possible. Once a ledger file is closed, it can’t be re-opened for writes.\u003c\/p\u003e\n\u003cp\u003eIn Pulsar, a managed ledger is developed as an abstraction over the BookKeeper\u0026rsquo;s ledger to add multiple ledger files to store data in several ledger files. Then during a read operation, it can concatenate the contents from these ledger files and serve the data as required. Therefore, there can be more than a single ledger for a topic. By default, BookKeeper ensures that messages directed to bookies are synced to disk, and only then is an acknowledgement dispatched to the broker.\u003c\/p\u003e\n\u003ch3 id=\u0022use-cases-of-bookkeeper-in-pulsar\u0022\u003eUse Cases of BookKeeper in Pulsar\u003c\/h3\u003e\n\u003cp\u003ePulsar uses Apache BookKeeper for use cases that include those listed below.\u003c\/p\u003e\n\u003ch4 id=\u0022scalability-reasons\u0022\u003eScalability Reasons\u003c\/h4\u003e\n\u003cp\u003eApache Pulsar is built for handling a large volume of messages. You can dynamically add more bookies to your Pulsar cluster if a single bookie node cannot meet the storage demand. Adding more bookies can increase the ledgers and therefore increase throughput as well. It is because bookies are designed to handle concurrent writes and read from multiple ledgers.\u003c\/p\u003e\n\u003ch4 id=\u0022replication\u0022\u003eReplication\u003c\/h4\u003e\n\u003cp\u003eApache Pulsar has a replication feature through which data redundancy is configurable based on the needs. This feature helps store the same data as multiple copies in multiple bookies. In this way, when a bookie fails, the brokers in Apache Pulsar can still serve a client\u0026rsquo;s request by reading the data from other bookies.\u003c\/p\u003e\n\u003cp\u003eApache BookKeeper is built with such a feature, and it is easy to replicate a message to the desired number of copies. You could configure the replication settings to control how many copies need to be maintained. Once configured, Apache BookKeeper will carry out the replication process for you.\u003c\/p\u003e\n\u003ch4 id=\u0022message-placement-policies\u0022\u003eMessage Placement Policies\u003c\/h4\u003e\n\u003cp\u003eYou can control the placement of each replicated message copy in your Pulsar instance. For example, you can retain a certain number of copies across racks in the same region and a certain number of copies in a rack of different regions. This paves the way to access messages in the time of disaster recovery scenarios.\u003c\/p\u003e\n\u003ch3 id=\u0022differences-between-zookeeper-and-bookkeeper\u0022\u003eDifferences Between ZooKeeper and BookKeeper\u003c\/h3\u003e\n\u003cp\u003eBoth ZooKeeper and BookKeeper store some form of data for Pulsar. However, the key difference lies in what sort of data these components store and serve.\u003c\/p\u003e\n\u003cp\u003eZooKeeper is used to store configuration data\/metadata for Pulsar, including the instance configuration data such as clusters, tenants, and namespaces, topic metadata, information on Broker load, and storing the metadata of BookKeeper, such as ledger information.\u003c\/p\u003e\n\u003cp\u003eBookKeeper, on the other hand, stores the actual event’s data (messages) in its storage for persistence and later reads\/replays messages at the time of need. The information about cursors is stored in BookKeeper as well. Cursors refer to the offset\/subscription position until consumers have subscribed to messages from each topic. Starting from Pulsar release version 2.8, the code packages\/Pulsar functions are stored in BookKeeper.\u003c\/p\u003e\n\u003ch2 id=\u0022conclusion\u0022\u003eConclusion\u003c\/h2\u003e\n\u003cp\u003ePulsar is a real-time distributed messaging platform proven for its highly scalable and multi-tenant capabilities. To achieve scalability, reliability, high availability, message durability, performance, and other criteria of a distributed application platform, Pulsar uses ZooKeeper and BookKeeper as its components.\u003c\/p\u003e\n\u003cp\u003eA Pulsar instance can have several ZooKeeper nodes and BookKeeper nodes based on the processing and storage needs. Pulsar uses ZooKeeper mainly for its capability to manage configuration, leader election, and task coordination in a distributed environment and BookKeeper for its scalable, durable, and high-performance storage ability.\u003c\/p\u003e\n"}]</script></head><body class='page bg-secondary'><div id=main-menu-mobile class=main-menu-mobile><ul></ul></div><div class=wrapper><div class='header sticky-top bg-secondary'><div class=container><div class=logo><a href=https://www.pulsar-neighborhood.io><img src=/svg/Pulsar-Neighborhood-Logo.svg class=img-fluid></a></div><div class=logo-mobile><a href=https://www.pulsar-neighborhood.io><img src=/svg/Neighborhood-Icon.svg class=img-fluid></a></div><div id=main-menu class=main-menu><ul><li><a href=/about><span>About The Pulsar Neighborhood</span></a></li><li><a href=https://pulsar.apache.org/ target=_blank><span>About Apache Pulsar</span></a></li><li><a href=https://pulsar.apache.org/docs/en/standalone/ target=_blank><span></span>Project Documentation</span></a></li><li><a href=/index.xml><img src=/svg/square-rss-solid.svg title="Subscribe to The Pulsar Neighborhood feed" class=img-fluid style=height:30px></a></li></ul></div><button id=toggle-main-menu-mobile class="hamburger hamburger--slider" type=button>
<span class=hamburger-box><span class=hamburger-inner></span></span></button></div></div><div class="container pt-2 pb-3"><div class=row><div class="col-0 col-md-2"><div class=sidebar><div class=mb-2><a href=/guides/getting-started><div class="col-12 btn btn-success">Get Started with Pulsar</div></a></div><div class="spotlight mb-2 border border-primary rounded"><div class="row bg-primary no-gutters"><div class="col-12 text-secondary p-1">&nbsp;Find Topics</div></div><div class=p-1><div class="row no-gutters"><div class="col-12 mb-1"><h4>Category</h4><ul><li>&nbsp;<a class=text-decoration-none href=/categories/at-the-edge>At the Edge</a> [3]</li><li>&nbsp;<a class=text-decoration-none href=/categories/cluster-administration>Cluster Administration</a> [3]</li><li>&nbsp;<a class=text-decoration-none href=/categories/getting-started>Getting Started</a> [15]</li><li>&nbsp;<a class=text-decoration-none href=/categories/machine-learning>Machine Learning</a> [2]</li><li>&nbsp;<a class=text-decoration-none href=/categories/moving-to-pulsar>Moving to Pulsar</a> [11]</li><li>&nbsp;<a class=text-decoration-none href=/categories/pulsar-architecture>Pulsar Architecture</a> [10]</li><li>&nbsp;<a class=text-decoration-none href=/categories/pulsar-components>Pulsar Components</a> [8]</li><li>&nbsp;<a class=text-decoration-none href=/categories/use-cases>Use Cases</a> [5]</li></ul></div><div class=col-12><h4>View All</h4><div class="mt-1 pb-1"><a href=/articles>Articles</a>
&nbsp;|&nbsp;<a href=/guides>Guides</a>
&nbsp;|&nbsp;<a href=/videos>Videos</a></div></div></div></div></div></div></div><div class="col-12 col-md-8"><div class=container><header class=mb-3><div class=pb-2></div><h1>Understanding the Roles of Zookeeper and Bookkeeper in Pulsar</h1><div class="row no-gutters"><div class="col col-auto mr-1">Categories:</div><div class="col col-auto"><a class=text-decoration-none href=/categories/pulsar-architecture>Pulsar Architecture</a>,&nbsp;</div><div class="col col-auto"><a class=text-decoration-none href=/categories/pulsar-components>Pulsar Components</a></div></div></header><div class="row mb-3 no-gutters border-top border-bottom"><div class=col-2><ul class="list-group list-group-horizontal mt-1 mb-1"><li class="list-group-item flex-fill border-0 p-0 mr-3"><a href="https://www.linkedin.com/sharing/share-offsite/?mini=true&url=https%3a%2f%2fwww.pulsar-neighborhood.io%2farticles%2funderstanding-the-roles-of-zookeeper-and-bookkeeper-in-pulsar%2f&title=Understanding%20the%20Roles%20of%20Zookeeper%20and%20Bookkeeper%20in%20Pulsar" target=_blank><img src=/svg/linkedin-in-brands.svg title="Share this on LinkedIn" class=img-fluid></a></li><li class="list-group-item flex-fill border-0 p-0 mr-3"><a target=_blank href="https://twitter.com/intent/tweet?text=Understanding%20the%20Roles%20of%20Zookeeper%20and%20Bookkeeper%20in%20Pulsar&url=https%3a%2f%2fwww.pulsar-neighborhood.io%2farticles%2funderstanding-the-roles-of-zookeeper-and-bookkeeper-in-pulsar%2f&hashtags=apachepulsar&via=pulsar_neighbor"><img src=/svg/twitter-brands.svg title="Share this on Twitter" class=img-fluid></a></li></ul></div><div class="col text-right"><span class=text-muted>Author:</span> Pulsar Neighborhood<br><span class=text-muted>Published:</span> August 23, 2022</div></div><article><p>Apache Pulsar is a well-known open-source platform for handling distributed event streams to serve real-time use cases. To carry out its operations, perform administrative tasks, and manage storage, Pulsar uses external components. Two of these components are <a href=https://pulsar.apache.org/docs/administration-zk-bk/ target=_blank>ZooKeeper and BookKeeper</a>.</p><p>ZooKeeper and BookKeeper are both open-source Apache products. Yahoo developed these libraries and then released them as open source to the Apache Software Foundation. In Pulsar, ZooKeeper handles configuration and coordination-related tasks, while BookKeeper is responsible for the persistent storage of message data.</p><p>Although they have some similarities, ZooKeeper and BookKeeper provide different administrative services in Pulsar. This article will help you to understand how ZooKeeper and BookKeeper work, the roles these components play in Pulsar, and the differences between ZooKeeper and BookKeeper, highlighting use cases where each component is particularly useful.</p><h2 id=overview-zookeeper-and-bookkeeper>Overview: ZooKeeper and BookKeeper</h2><p>Before turning to the roles that ZooKeeper and BookKeeper play in Pulsar, let’s take a closer look at what each of these components are.</p><h3 id=zookeeper>ZooKeeper</h3><p>Apache ZooKeeper is a battle-tested service developed to serve some of the key requirements of distributed applications. These include:</p><ul><li>Configuration management</li><li>Naming service</li><li>Leader election process</li><li>Distributed synchronization service</li></ul><p>The above features are essential for a distributed application. Zookeeper has these features out of the box, making task coordination in a distributed application much simpler.</p><p>Although ZooKeeper serves several distributed application needs, it’s the application’s responsibility to know which ZooKeeper features are required that the integrated application requires. For example, a distributed application that integrates with ZooKeeper can use its configuration management to store certain metadata specific to the application, which might differ from the metadata or configuration data stored by another distributed application.</p><p>ZooKeeper has a filesystem-like directory structure, called znodes, to manage configuration data. Each znode can store data of a maximum size of 1 MB and can have another child node. The entire hierarchical structure of znodes is available for access in the ZooKeeper cluster nodes’ memory. This way, a swift and scalable response can be achieved when a configuration read request comes from a client.</p><h3 id=bookkeeper>BookKeeper</h3><p>Apache BookKeeper was originally a sub-project developed under ZooKeeper. Later, it emerged as a top-level project. BookKeeper is a highly scalable, reliable, and performant storage solution optimized to serve real-time workloads. Following are some of the BookKeeper’s capabilities:</p><ul><li>High-performance distributed storage solution</li><li>Highly scalable</li><li>Provides IO isolation</li><li>Data replication</li><li>Targeted message placement</li></ul><h2 id=zookeeper-and-bookkeeper-whats-the-difference>ZooKeeper and BookKeeper: What’s the Difference?</h2><p>Now that you have understood the high-level overview of ZooKeeper and BookKeeper, the following section will provide you with the details:</p><ul><li>What’s the difference between these components?</li><li>Which role do these components play in Pulsar?</li><li>How does Pulsar use these components for various use cases to meet its goals?</li></ul><h3 id=the-role-of-zookeeper-in-pulsar>The Role of ZooKeeper in Pulsar</h3><p>Pulsar architecture supports multi-cluster deployment models distributed across multiple geographical regions. This is configurable per the customer’s need and policy on high availability and disaster recovery plans. Regardless of whether it’s a Pulsar instance with a single cluster or multiple clusters, the role of ZooKeeper is to handle configuration, the leader-election process, and coordination tasks for a Pulsar instance.</p><p>From an administrative perspective, note that two separate ZooKeeper quorums are involved in the Pulsar instance. A quorum in ZooKeeper is the minimum number of ZooKeeper nodes in a cluster that should be available to serve the client requests.</p><p>One quorum serves individual cluster-level configuration management and coordination of tasks within the cluster. The other quorum is for global configuration management and task coordination of an entire Pulsar instance with multiple clusters.</p><p>In the case of a Pulsar instance with a single cluster, you can use the same cluster of ZooKeeper nodes both for local cluster needs and global instance needs. This is usually done to save resource costs and minimize the effort involved with server administration tasks.</p><p>However, in the case of a Pulsar instance with a multi-cluster deployment mode distributed across various geographical regions, ensure a separate global configuration store configured to include ZooKeeper clusters from multiple regions. This setup enables high availability in the event of failures and facilitates topic partitions spanning different regions. To understand more on this, refer to <a href=https://pulsar.apache.org/docs/administration-zk-bk/#deploy-configuration-store target=_blank>Pulsar documentation</a>.</p><h3 id=use-cases-of-zookeeper-in-pulsar>Use Cases of ZooKeeper in Pulsar</h3><p>Pulsar uses Apache ZooKeeper for use cases that include those outlined below.</p><h4 id=leader-election-process>Leader Election Process</h4><p>A leader node is the one that is responsible for writes, and the other nodes, the followers, receive the updates made by the leader node. In this way, all cluster nodes eventually become consistent with the data. In the case of read requests, any node in the cluster can serve the request.</p><p>For example, assume there are three nodes in a ZooKeeper cluster, with node 1 elected as a leader node, and nodes 2 and 3 marked as followers. Any write or update requests will be forwarded to node 1 to handle the request, and the other nodes will eventually become synchronized with the updated data. When a client application sends a read request to any of the ZooKeeper follower nodes, the data is served locally from that follower node.</p><p>This is possible because, in ZooKeeper, all the nodes have the data to serve the read request. When a leader node goes down in a cluster, a quorum is established, and a new leader is elected from the followers. This process happens automatically and should occur as efficiently as possible.</p><h4 id=metadata-and-configuration-management>Metadata and Configuration Management</h4><p>Pulsar instance configuration, such as cluster configuration data, tenants and namespace metadata information, and topic metadata, are stored in ZooKeeper. The broker in Pulsar ought to know the ledgers that correspond to a topic. Such metadata information is also stored in ZooKeeper. Whenever a client requests any configuration/metadata information stored in the ZooKeeper, it gets served.</p><h4 id=monitoring-the-health-status-of-nodes>Monitoring the Health Status of Nodes</h4><p>ZooKeeper stores the health information of each broker in the Pulsar cluster through its ephemeral znodes. Ephemeral znodes are a kind of znode that exist as long as the corresponding client session is active. It means there is an internal mapping and metadata information in ZooKeeper to understand which znodes are for which broker session.</p><p>Once the client session is closed/unavailable, the corresponding znode will be removed from ZooKeeper. This way, the availability of information on which brokers are active to serve topics and which brokers are dying or dead already are maintained in ZooKeeper. The znode removal action/information of dead brokers is used during task coordination to decide/choose a suitable active broker to serve a client’s request (producer/consumer client) for acting on a message/event.</p><h3 id=the-role-of-bookkeeper-in-pulsar>The Role of BookKeeper in Pulsar</h3><p>The role of BookKeeper in Pulsar is to handle message/event storage needs for a Pulsar instance. Where do the incoming messages to a Pulsar topic get stored? The answer is in BookKeeper nodes/Bookies.</p><p>A producer client generates messages/events and reaches the broker node. Broker being a stateless component in Pulsar, forwards the messages to Bookies for persistence. Bookies are based on a distributed Write-Ahead Log system that utilizes the ledger mechanism to store received messages.</p><p>A ledger is an important concept in the BookKeeper. It’s like a file that’s opened only once to write and append the data only to the end. However, data read from the ledger at a random position, such as from the middle, is possible. Once a ledger file is closed, it can’t be re-opened for writes.</p><p>In Pulsar, a managed ledger is developed as an abstraction over the BookKeeper&rsquo;s ledger to add multiple ledger files to store data in several ledger files. Then during a read operation, it can concatenate the contents from these ledger files and serve the data as required. Therefore, there can be more than a single ledger for a topic. By default, BookKeeper ensures that messages directed to bookies are synced to disk, and only then is an acknowledgement dispatched to the broker.</p><h3 id=use-cases-of-bookkeeper-in-pulsar>Use Cases of BookKeeper in Pulsar</h3><p>Pulsar uses Apache BookKeeper for use cases that include those listed below.</p><h4 id=scalability-reasons>Scalability Reasons</h4><p>Apache Pulsar is built for handling a large volume of messages. You can dynamically add more bookies to your Pulsar cluster if a single bookie node cannot meet the storage demand. Adding more bookies can increase the ledgers and therefore increase throughput as well. It is because bookies are designed to handle concurrent writes and read from multiple ledgers.</p><h4 id=replication>Replication</h4><p>Apache Pulsar has a replication feature through which data redundancy is configurable based on the needs. This feature helps store the same data as multiple copies in multiple bookies. In this way, when a bookie fails, the brokers in Apache Pulsar can still serve a client&rsquo;s request by reading the data from other bookies.</p><p>Apache BookKeeper is built with such a feature, and it is easy to replicate a message to the desired number of copies. You could configure the replication settings to control how many copies need to be maintained. Once configured, Apache BookKeeper will carry out the replication process for you.</p><h4 id=message-placement-policies>Message Placement Policies</h4><p>You can control the placement of each replicated message copy in your Pulsar instance. For example, you can retain a certain number of copies across racks in the same region and a certain number of copies in a rack of different regions. This paves the way to access messages in the time of disaster recovery scenarios.</p><h3 id=differences-between-zookeeper-and-bookkeeper>Differences Between ZooKeeper and BookKeeper</h3><p>Both ZooKeeper and BookKeeper store some form of data for Pulsar. However, the key difference lies in what sort of data these components store and serve.</p><p>ZooKeeper is used to store configuration data/metadata for Pulsar, including the instance configuration data such as clusters, tenants, and namespaces, topic metadata, information on Broker load, and storing the metadata of BookKeeper, such as ledger information.</p><p>BookKeeper, on the other hand, stores the actual event’s data (messages) in its storage for persistence and later reads/replays messages at the time of need. The information about cursors is stored in BookKeeper as well. Cursors refer to the offset/subscription position until consumers have subscribed to messages from each topic. Starting from Pulsar release version 2.8, the code packages/Pulsar functions are stored in BookKeeper.</p><h2 id=conclusion>Conclusion</h2><p>Pulsar is a real-time distributed messaging platform proven for its highly scalable and multi-tenant capabilities. To achieve scalability, reliability, high availability, message durability, performance, and other criteria of a distributed application platform, Pulsar uses ZooKeeper and BookKeeper as its components.</p><p>A Pulsar instance can have several ZooKeeper nodes and BookKeeper nodes based on the processing and storage needs. Pulsar uses ZooKeeper mainly for its capability to manage configuration, leader election, and task coordination in a distributed environment and BookKeeper for its scalable, durable, and high-performance storage ability.</p></article><div class="row border border-primary rounded"><div class="col p-2"><h3>You might also like...</h3><div class=row><div class="col text-center p-2"><div><a href=/articles/the-difference-between-persistent-and-non-persistent-topics-in-apache-pulsar/><img src=https://user-images.githubusercontent.com/16946028/175392241-c8347127-d310-4acd-9a99-0e757bd5e98f.png alt class=img-fluid style=max-width:150px></a></div><div class=pt-2><a href=/articles/the-difference-between-persistent-and-non-persistent-topics-in-apache-pulsar/>The Difference Between Persistent and Non Persistent Topics in Apache Pulsar</a></div><div class=pt-2>This article will explore what Pulsar topics are, the differences between persistent and …</div></div><div class="col text-center p-2"><div><a href=/articles/how-pulsar-and-kafka-partitions-work-and-how-they-differ/><img src=https://user-images.githubusercontent.com/16946028/168374625-c69691a5-420d-4dfd-8229-d0dcf8e03934.png alt class=img-fluid style=max-width:150px></a></div><div class=pt-2><a href=/articles/how-pulsar-and-kafka-partitions-work-and-how-they-differ/>How Pulsar and Kafka Partitions Work (And How They Differ)</a></div><div class=pt-2>Both Pulsar and Kafka aim to increase the amount of data that can be consumed and processed by …</div></div><div class="col text-center p-2"><div class=pt-2><a href=/videos/apache-pulsar-deep-dive-an-end-to-end-view-of-the-data-flow/>Apache Pulsar Deep Dive an End-to-End View of the Data Flow</a></div><div class=pt-2>Enrico Olivelli gives us a tour of how data moves from the Producer to the Consumer.</div></div></div></div></div><br><div id=disqus_thread></div><script type=text/javascript>(function(){if(window.location.hostname=="localhost")return;var t,e=document.createElement("script");e.type="text/javascript",e.async=!0,t="pulsar-neighborhood",e.src="//"+t+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div></div><div class="col-0 col-md-2"><nav class="navbar navbar-light mb-3"><div class=row><div class=col-12><h4>In this article</h4></div><div class="col-12 border-left border-primary pr-0"><nav id=TableOfContents><ul><li><a href=#overview-zookeeper-and-bookkeeper>Overview: ZooKeeper and BookKeeper</a><ul><li><a href=#zookeeper>ZooKeeper</a></li><li><a href=#bookkeeper>BookKeeper</a></li></ul></li><li><a href=#zookeeper-and-bookkeeper-whats-the-difference>ZooKeeper and BookKeeper: What’s the Difference?</a><ul><li><a href=#the-role-of-zookeeper-in-pulsar>The Role of ZooKeeper in Pulsar</a></li><li><a href=#use-cases-of-zookeeper-in-pulsar>Use Cases of ZooKeeper in Pulsar</a></li><li><a href=#the-role-of-bookkeeper-in-pulsar>The Role of BookKeeper in Pulsar</a></li><li><a href=#use-cases-of-bookkeeper-in-pulsar>Use Cases of BookKeeper in Pulsar</a></li><li><a href=#differences-between-zookeeper-and-bookkeeper>Differences Between ZooKeeper and BookKeeper</a></li></ul></li><li><a href=#conclusion>Conclusion</a></li></ul></nav></div></div></nav></div></div></div></div><div class="sub-footer m-5"><div class=row><div class="col-12 text-center"><a href=https://github.com/pulsar-neighborhood/pulsar-neighborhood.github.io/blob/main/content/articles/understanding-the-roles-of-zookeeper-and-bookkeeper-in-pulsar.md target=_blank>Improve this page</a></div></div><div class="col-8 offset-2"><hr class="bg-primary text-primary"></div><div class="sub-footer-inner mt-2"><div><div class=mb-1>Pulsar Neighborhood</div><div><ul><li style=width:40px><a href=https://github.com/pulsar-neighborhood target=_blank><img src=/svg/github-brands.svg title="Pulsar Neighborhood on GitHub" class=img-fluid></a></li><li class="ml-3 mr-1" style=width:40px><a href=https://twitter.com/pulsar_neighbor target=_blank><img src=/svg/twitter-brands.svg title="Pulsar Neighborhood on Twitter" class=img-fluid></a></li><li style=width:40px><a href=https://www.youtube.com/c/ApachePulsarNeighborhood target=_blank><img src=/svg/youtube-brands.svg title="Pulsar Neighborhood on YouTube" class=img-fluid></a></li><li style=width:40px><a href=https://datastudio.google.com/reporting/743d9f31-c80f-4e60-b520-730631d3c250 target=_blank><img src=/png/google-analytics.png title="Pulsar Neighborhood analytics" class=img-fluid></a></li></ul></div></div><div class=p-5></div><div><div class=mb-1>Apache Pulsar</div><div><ul><li style=width:40px><a href=https://pulsar.apache.org target=_blank><img src=/png/pulsar-icon.jpg title="Apache Pulsar project home" class=img-fluid></a></li><li class="ml-3 mr-1" style=width:40px><a href=https://github.com/apache-pulsar target=_blank><img src=/svg/github-brands.svg title="Apache Pulsar on GitHub" class=img-fluid></a></li><li class=mr-1 style=width:40px><a href=https://twitter.com/Apache_Pulsar target=_blank><img src=/svg/twitter-brands.svg title="Apache Pulsar on Twitter" class=img-fluid></a></li><li class=mr-1 style=width:30px><a href=https://stackoverflow.com/questions/tagged/apache-pulsar target=_blank><img src=/svg/stack-overflow-brands.svg title="Apache Pulsar on Stackoverflow" class=img-fluid></a></li><li style=width:40px><a href=https://apache-pulsar.slack.com target=_blank><img src=/svg/slack-brands.svg title="Apache Pulsar slack channel" class=img-fluid></a></li></ul></div></div></div><div class="row text-center mb-3"><div class=col-12><a class="btn btn-info" href=https://pulsar.apache.org/community/ target=_blank>Join the Pulsar community</a></div></div><div class="row text-center"><div class="col-12 text-center"><div><a href=https://github.com/pulsar-neighborhood/pulsar-neighborhood.github.io/issues/new/choose>Contact Us</a></div></div></div></div><script type=text/javascript src=/js/scripts.min.8efe3e711319c2d0a300a084134e3f3bedcb60dce21f1e0ef12767f654242b44.js></script>
<script src=https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js integrity=sha384-fQybjgWLrvvRgtW6bFlB7jaZrFsaBXjsOMm/tB9LTS58ONXgqbR9W8oWht/amnpF crossorigin=anonymous></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-8S9SD43SBH"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-8S9SD43SBH")</script></body></html>